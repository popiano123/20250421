import{N as F,d as b,r as p,ap as w,P as B,e as _,g as u,h as n,i as a,o as k,M as g,f as x,j as m,l as E}from"./index.9ba822ed.js";import{s as K}from"./card.esm.26e16bcd.js";import{b as L,c}from"./datatable.esm.b172a70c.js";import{c as h}from"./index.f741a67e.js";import"./radiobutton.esm.69c4f86a.js";import"./index.esm.caa83189.js";function N(){return F({url:"/admin/api_keys/generate",withLogin:!0})}function $(){return F({url:"/admin/api_keys",withLogin:!0})}function j(f){return F({url:"/admin/api_keys/delete",method:"GET",params:{id:f},withLogin:!0})}const M={class:"col-12"},T={class:"md:flex md:flex-row md:flex-nowrap"},Y=b({__name:"ApiKey",setup(f){const d=p(!1),i=p([]),t=E(),A=w(),o=p(!1),v=(e,s)=>{A.require({target:e.target,message:"\u60A8\u8981\u5220\u9664\u6B64\u5BC6\u94A5\u5417\uFF1F",icon:"pi pi-info-circle",rejectClass:"p-button-secondary p-button-outlined p-button-sm",acceptClass:"p-button-danger p-button-sm",rejectLabel:"\u53D6\u6D88",acceptLabel:"\u786E\u5B9A",accept:async()=>{try{t.default("\u6B63\u5728\u5220\u9664\u2026\u2026"),await j(s.id),t.success("\u5220\u9664\u6210\u529F");const r=i.value.findIndex(l=>l.id===s.id);i.value.splice(r,1)}catch{t.warn("\u5220\u9664\u5931\u8D25\uFF01")}}})},y=async()=>{o.value=!0;try{d.value=!0;const e=await $();e.data.data.length>0&&(i.value.length=0,i.value.push(...e.data.data))}catch{t.warn("\u52A0\u8F7D\u5BC6\u94A5\u5931\u8D25\uFF01\u8BF7\u7A0D\u540E\u5237\u65B0\u9875\u9762\uFF01")}finally{d.value=!1,o.value=!1}},C=e=>{h(e.key||""),t.success("\u590D\u5236\u6210\u529F\uFF01")},D=async()=>{o.value=!0;try{const{data:e}=(await N()).data;t.success("\u751F\u6210\u6210\u529F\uFF01\u5DF2\u81EA\u52A8\u590D\u5236\u3002"),h(e.key),await y()}catch{t.warn("\u751F\u6210\u5931\u8D25\uFF01")}finally{o.value=!1}};return B(y),(e,s)=>(k(),_("div",M,[u(a(K),null,{content:n(()=>[u(a(L),{value:i.value,dataKey:"id",tableStyle:"min-width: 60rem",loading:d.value},{loading:n(()=>s[0]||(s[0]=[g(" \u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E\u2026\u2026 ")])),empty:n(()=>s[1]||(s[1]=[g(" \u6682\u65F6\u6CA1\u6709\u6570\u636E\uFF0C\u6DFB\u52A0\u4E00\u4E2A\u5427\uFF01 ")])),header:n(()=>[x("div",T,[u(a(m),{loading:o.value,icon:"pi pi-plus",label:"\u6DFB\u52A0",class:"mr-2 mb-2 flex-grow-0",onClick:D},null,8,["loading"])])]),default:n(()=>[u(a(c),{field:"id",header:"ID",sortable:!0}),u(a(c),{field:"key",header:"KEY"}),u(a(c),{field:"use_count",header:"\u4F7F\u7528\u6B21\u6570"}),u(a(c),{header:"\u64CD\u4F5C"},{body:n(({data:r})=>[u(a(m),{icon:"pi pi-copy",rounded:"",class:"mb-2 mr-2",onClick:l=>C(r)},null,8,["onClick"]),u(a(m),{icon:"pi pi-trash",severity:"danger",rounded:"",class:"mb-2 mr-2",onClick:l=>v(l,r)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"])]),_:1})]))}});export{Y as default};
