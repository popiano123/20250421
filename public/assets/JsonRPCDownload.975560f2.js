var N=Object.defineProperty;var R=(E,e,u)=>e in E?N(E,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):E[e]=u;var F=(E,e,u)=>(R(E,typeof e!="symbol"?e+"":e,u),u);import{aD as q,d as M,b as T,c as W,aE as j,r as J,$ as H,a1 as y,P as L,aF as G,w as C,o as v,e as K,g as p,h as z,f as t,A as _,i as o,s as b,j as V,M as B,K as Q,l as X}from"./index.9ba822ed.js";import{s as $}from"./divider.esm.ec276b4c.js";import{d as Y}from"./datatable.esm.b172a70c.js";import{d as Z,u as uu}from"./Parsed.fb8f4839.js";import{s as S}from"./tag.esm.439c4aa3.js";import"./radiobutton.esm.69c4f86a.js";import"./index.esm.caa83189.js";import"./index.esm.ac3817b7.js";import"./progressbar.esm.02fd659a.js";import"./parse.ccca86de.js";import"./index.f741a67e.js";class h{constructor(e){F(this,"_config");F(this,"_requestId");F(this,"socket");F(this,"callbacks",new Map);F(this,"onOpen");F(this,"onClose");this._config=e,this._requestId=0}get requestId(){return`F4Pan-${++this._requestId}`}get url(){return`${this._config.protocol}${this._config.ssl?"s":""}://${this._config.host}:${this._config.port}/jsonrpc`}isOpen(){var e;return this._config.protocol==="ws"?((e=this.socket)==null?void 0:e.readyState)===WebSocket.OPEN:!0}async init(){if(this._config.protocol==="http"){this._onOpen();return}if(!this.isOpen()){this.socket||(this.socket=new WebSocket(this.url),this.socket.onopen=this._onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onclose=this._onClose.bind(this));for(let e=0;e<10;e++)if(await Z(1e3),this.isOpen())return;throw new Error("\u8FDE\u63A5 WebSocket \u5931\u8D25\u3002")}}_onOpen(){var e;(e=this.onOpen)==null||e.call(this)}_onClose(){var e;(e=this.onClose)==null||e.call(this)}onMessage(e){var c;const u=JSON.parse(e.data);u.id&&this.callbacks.has(u.id)&&((c=this.callbacks.get(u.id))==null||c(u),this.callbacks.delete(u.id))}close(){this.socket&&(this.callbacks.forEach(e=>{e==null||e(null)}),this.callbacks.clear(),this.socket.close())}async call(e,u){var g;const c={jsonrpc:"2.0",id:this.requestId,method:e,params:[`token:${this._config.token}`,...u]};try{if(this._config.protocol==="http"){const m=await q.post(this.url,c);if(m.status===200)return m.data}else return this.isOpen?(g=await new Promise(m=>{var l;this.callbacks.set(c.id,m),(l=this.socket)==null||l.send(JSON.stringify(c))}))!=null?g:null:Promise.resolve(null)}catch{return null}return null}}F(h,"VersionAction","aria2.getVersion"),F(h,"AddUriAction","aria2.addUri");const eu={class:"formgrid grid"},su={class:"field col"},tu={class:"field col"},ou={class:"field col"},lu={class:"formgrid grid"},au={class:"field col"},iu={class:"field col"},ru={class:"formgrid grid"},nu={class:"field col"},du={class:"field col"},vu=M({__name:"JsonRPCDownload",setup(E,{expose:e}){let u;const c=T(),g=W(),l=j(c).rpc,r=J(!1),n=X(),{log:A}=uu(),f=H({ws:!1,test:!1}),D=y({get:()=>({code:l.value.type,name:l.value.type.toUpperCase()}),set:a=>l.value.type=a.code}),d=y(()=>f.ws&&f.test),O=async()=>{if(!d.value){n.warn("\u8BF7\u5148\u8FDE\u63A5 Aria2 \u5BA2\u6237\u7AEF\u3002");return}r.value=!0;const a=await(u==null?void 0:u.call("aria2.getGlobalOption",[]));if(!a){A("\u83B7\u53D6 Aria2 \u5BA2\u6237\u7AEF \u914D\u7F6E\u5931\u8D25","error"),n.warn("\u83B7\u53D6 Aria2 \u5BA2\u6237\u7AEF \u914D\u7F6E\u5931\u8D25\uFF01");return}const s=a.result;s.dir&&(l.value.basedir=s.dir,n.success("\u83B7\u53D6 Aria2 \u5BA2\u6237\u7AEF \u914D\u7F6E\u6210\u529F\uFF01")),r.value=!1},U=(a,s,i)=>{if(!d.value){n.error("\u8BF7\u5148\u8FDE\u63A5 Aria2 \u5BA2\u6237\u7AEF\u3002");return}A(`\u63A8\u9001 ${a.body.filename} \u5230 Aria2 \u5BA2\u6237\u7AEF `);const P=c.rpc.basedir.replace(/\/$/,""),I=[[a.body.dlink],{out:a.body.filename,header:[`User-Agent: ${g.parse_ua}`],dir:`${P}/${i}`}];u==null||u.call(h.AddUriAction,I).then(()=>{A(`\u6210\u529F\u63A8\u9001 ${a.body.filename} \u5230 Aria2 \u5BA2\u6237\u7AEF\uFF01`,"success"),n.success(`\u6210\u529F\u63A8\u9001 ${a.body.filename} \u5230 Aria2 \u5BA2\u6237\u7AEF\uFF01`)}).catch(()=>{n.warn(`\u63A8\u9001 ${a.body.filename} \u5230 Aria2 \u5BA2\u6237\u7AEF\u5931\u8D25\u3002`),A(`\u63A8\u9001 ${a.body.filename} \u5230 Aria2 \u5BA2\u6237\u7AEF\u5931\u8D25\u3002`,"warning")})},k=()=>{u&&w(),A("\u521D\u59CB\u5316 Aria2 \u8FDE\u63A5"),u=new h({host:l.value.host,port:parseInt(l.value.port),ssl:["https","wss"].includes(D.value.code),token:l.value.token,protocol:D.value.code.startsWith("http")?"http":"ws"}),u.onOpen=()=>{f.ws=!0},u.onClose=()=>{f.ws=!1}},w=()=>{u&&(u==null||u.close(),u=void 0)},x=async()=>{var a;if(d.value)A("\u5173\u95ED Aria2 Client","warning"),u==null||u.close(),f.ws=!1,f.test=!1;else{A("\u521B\u5EFA Aria2 Client","warning"),r.value=!0;try{await(u==null?void 0:u.init())}catch(i){A((a=i==null?void 0:i.message)!=null?a:"\u672A\u77E5\u7684 Aria2 Client \u9519\u8BEF","error"),n.error(i==null?void 0:i.message),r.value=!1;return}await(u==null?void 0:u.call(h.VersionAction,[]))?f.test=!0:n.warn("\u8FDE\u63A5\u5230 Aria2 \u5BA2\u6237\u7AEF\u5931\u8D25\uFF0C\u8BF7\u67E5\u770B\u63A7\u5236\u53F0\u3002"),r.value=!1}};return e({onSuccess:U}),L(()=>{k()}),G(()=>{w()}),C(D,()=>{k()}),C(d,a=>{a?n.success("\u8FDE\u63A5\u5230 Aria2 \u6210\u529F\uFF01"):n.warn("\u65AD\u5F00 Aria2 \u8FDE\u63A5\uFF01")}),(a,s)=>(v(),K(Q,null,[p(o($),{align:"left",type:"solid"},{default:z(()=>[s[5]||(s[5]=t("b",null,"JSON RPC \u2022",-1)),d.value?(v(),_(o(S),{key:0,class:"ml-1",severity:"success",value:"\u8FDE\u63A5\u6210\u529F"})):(v(),_(o(S),{key:1,class:"ml-1",severity:"danger",value:"\u8FDE\u63A5\u65AD\u5F00"}))]),_:1}),t("div",eu,[t("div",su,[s[6]||(s[6]=t("label",{for:"type"},"\u901A\u4FE1\u534F\u8BAE",-1)),p(o(Y),{disabled:d.value||r.value,modelValue:D.value,"onUpdate:modelValue":s[0]||(s[0]=i=>D.value=i),options:[{name:"HTTP",code:"http"},{name:"HTTPS",code:"https"},{name:"WS",code:"ws"},{name:"WSS",code:"wss"}],optionLabel:"name",placeholder:"\u9009\u62E9\u901A\u4FE1\u534F\u8BAE"},null,8,["disabled","modelValue"])]),t("div",tu,[s[7]||(s[7]=t("label",{for:"host"},"\u4E3B\u673A",-1)),p(o(b),{type:"text",placeholder:"localhost",modelValue:o(l).host,"onUpdate:modelValue":s[1]||(s[1]=i=>o(l).host=i),disabled:d.value||r.value},null,8,["modelValue","disabled"])]),t("div",ou,[s[8]||(s[8]=t("label",{for:"port"},"\u7AEF\u53E3",-1)),p(o(b),{type:"number",placeholder:"6800",modelValue:o(l).port,"onUpdate:modelValue":s[2]||(s[2]=i=>o(l).port=i),disabled:d.value||r.value},null,8,["modelValue","disabled"])])]),t("div",lu,[t("div",au,[s[9]||(s[9]=t("label",{for:"token"},"\u5BC6\u94A5",-1)),p(o(b),{type:"text",modelValue:o(l).token,"onUpdate:modelValue":s[3]||(s[3]=i=>o(l).token=i),disabled:d.value||r.value},null,8,["modelValue","disabled"])]),t("div",iu,[p(o(V),{label:d.value?"\u65AD\u5F00":"\u8FDE\u63A5",style:{"margin-top":"25px"},id:"driver-step-test-json-rpc",loading:r.value,onClick:x},null,8,["label","loading"])])]),t("div",ru,[t("div",nu,[s[10]||(s[10]=t("label",{for:"basedir"},"\u4E0B\u8F7D\u76EE\u5F55(\u6700\u597D\u4E0D\u8981\u7559\u7A7A)",-1)),p(o(b),{type:"text",placeholder:"",modelValue:o(l).basedir,"onUpdate:modelValue":s[4]||(s[4]=i=>o(l).basedir=i)},null,8,["modelValue"])]),t("div",du,[p(o(V),{label:"\u83B7\u53D6\u914D\u7F6E",style:{"margin-top":"25px"},id:"driver-step-test-json-rpc",loading:r.value,onClick:O},null,8,["loading"])])]),p(o($)),s[11]||(s[11]=t("p",null,[B("\u4E0B\u8F7D\u76EE\u5F55\u4E3A\u5728\u64CD\u4F5C\u7CFB\u7EDF\u4E2D\u76EE\u5F55\uFF0C\u800C\u4E0D\u662F\u7F51\u76D8\u76EE\u5F55\uFF0C\u5982\u679C\u7559\u7A7A\u53EF\u80FD\u4F1A\u73B0\u5728\u5728\u64CD\u4F5C\u7CFB\u7EDF\u7684\u6839\u76EE\u5F55\uFF0C\u5982\u679C\u4E0D\u77E5\u9053\u5F53\u524D\u914D\u7F6E\u7684\u4E0B\u8F7D\u76EE\u5F55\uFF0C\u53EF\u4EE5\u70B9\u51FB\u3010\u83B7\u53D6\u914D\u7F6E\u3011\u6765\u81EA\u52A8\u83B7\u53D6\u3002"),t("br"),t("strong",null,"\u4F8B\u5982\uFF1A"),t("br"),B(" \u4E0B\u8F7D\u76EE\u5F55\u662F\uFF1AD:/\u4E0B\u8F7D"),t("br"),B(" \u9009\u62E9\u7684\u6587\u4EF6\u5939\u662F\uFF1A/\u89C6\u9891/a.mp4"),t("br"),B(" \u90A3\u4E48\u4E0B\u8F7D\u5730\u5740\u662F\uFF1AD:/\u4E0B\u8F7D/\u89C6\u9891/a.mp4"),t("br"),t("strong",null,"\u4FDD\u5B58\u7684\u6587\u4EF6\u5939\u548C\u60A8\u5206\u4EAB\u51FA\u7684\u6587\u4EF6\u7684\u6839\u76EE\u5F55\u6709\u5173\uFF0C\u548C\u60A8\u7F51\u76D8\u7684\u5B58\u50A8\u8DEF\u5F84\u65E0\u5173\u3002")],-1))],64))}});export{vu as default};
